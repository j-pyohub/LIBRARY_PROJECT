<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>ì˜ˆì•½ ë‹¬ë ¥ (Bootstrap ì ìš©)</title>

<!-- âœ… Bootstrap 5.3.0 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
table, th, td { border-collapse: collapse; }

#container { margin-top: 20px; }

.calendar-controls {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  margin-bottom: 15px;
}

/* âœ… ë‚ ì§œë¥¼ ì˜¤ë¥¸ìª½ ìƒë‹¨ìœ¼ë¡œ ì •ë ¬ */
.month-view td {
  position: relative;
  height: 80px;
  vertical-align: top !important;
}
.month-view td strong {
  position: absolute;
  top: 4px;
  right: 6px;
  font-size: 0.9rem;
}
.month-view td small {
  display: block;
  margin-top: 22px;
  font-size: 0.75rem;
  color: #555;
}

/* âœ… ì£¼ê°„ / ì¼ê°„ ë‹¬ë ¥ì˜ í‘œ ë†’ì´ ì¶•ì†Œ */
.week-view td, .day-view td {
  height: 36px;
  padding: 4px 6px !important;
  font-size: 0.85rem;
  vertical-align: middle !important;
}

/* ì„ íƒ ê°•ì¡° */
.table-hover tbody tr.table-active td { background-color: #e7f1ff !important; }
</style>
</head>

<body class="bg-body-tertiary">
  <div class="container-fluid">
    <div class="row">

      <!-- ì—¬ê¸°ì„œ ì‚¬ì´ë“œë°”ë¥¼ ì£¼ì… -->
      <div id="sidebar-slot" class="col-2 p-0"></div>

      <!-- âœ… ë©”ì¸ ì½˜í…ì¸  -->
      <main class="col-10 p-4">
        <div class="container py-4">
          <h2 class="text-center mb-4">ì˜ˆì•½ ë‹¬ë ¥ (Bootstrap ë²„ì „)</h2>

          <div class="calendar-controls">
            <!-- âœ… ë“œë¡­ë‹¤ìš´ -->
            <div class="d-inline-flex align-items-center">
              <label for="viewSelect" class="me-2 mb-0 fw-bold">ì›”/ì£¼/ì¼ ì„ íƒ</label>
              <select id="viewSelect" class="form-select form-select-sm w-auto">
                <option value="month" selected>Month</option>
                <option value="week">Week</option>
                <option value="day">Day</option>
              </select>
            </div>

            <!-- âœ… ì´ì „/ë‹¤ìŒ ë²„íŠ¼ -->
            <div>
              <button id="prev" class="btn btn-outline-dark">â—€</button>
              <span id="ym" class="fw-bold fs-5">â€”</span>
              <button id="next" class="btn btn-outline-dark">â–¶</button>
            </div>
          </div>

          <div id="container"></div>

        </div>

        <!-- âœ… ì˜ˆì•½ ë²„íŠ¼ ì˜ì—­ -->
        <div class="d-flex justify-content-end gap-2 mt-4 pe-4">
          <!-- ì˜ˆì•½ ë“±ë¡ ë²„íŠ¼ -->
          <button class="btn btn-outline-primary px-4" data-bs-toggle="modal" data-bs-target="#reservationModal">ì˜ˆì•½ ë“±ë¡</button>
          <!-- ì˜ˆì•½ ëª©ë¡ ë²„íŠ¼ -->
          <button class="btn btn-outline-primary px-4" data-bs-toggle="modal" data-bs-target="#managerReservationModal">ì˜ˆì•½ ëª©ë¡</button>
        </div>
      </main>
    </div>
  </div>

  <!-- âœ… Bootstrap JS (í•œ ë²ˆë§Œ ë¡œë“œ) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


  <!-- ============================
       âœ… ì˜ˆì•½ ë“±ë¡ ëª¨ë‹¬
  ============================ -->
  <div class="modal fade" id="reservationModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content custom-modal-size">
        <div class="modal-header">
          <h5 class="modal-title fw-bold text-center">ì˜ˆì•½ ë“±ë¡</h5>
          <button class="btn btn-primary modal-back-btn">ë‹«ê¸°</button>
        </div>

        <div class="modal-body">
          <form>
            <div class="col-md-4 mb-3">
              <label class="form-label">ì´ë¦„</label>
              <div class="input-group">
                <input type="text" id="patientName" class="form-control" readonly>
                <button class="btn btn-outline-danger" type="button" data-bs-toggle="modal" data-bs-target="#patientSearchModal">í™˜ì ì¡°íšŒ</button>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">ì¼ì‹œ</label>
              <div class="row g-2 align-items-center">
                <div class="col-md-4 col-12">
                  <input type="date" class="form-control" id="reserveDate">
                </div>
                <div class="col-md-3 col-6">
                  <input type="time" class="form-control" id="reserveTime">
                </div>
              </div>
            </div>

            <div class="col-md-4 mb-3">
              <label class="form-label">í™˜ìì—°ë½ì²˜</label>
              <input type="text" id="patientPhone" class="form-control" readonly>
            </div>

            <div class="col-md-4 mb-3">
              <label class="form-label">ë‹´ë‹¹ì˜ì‚¬ / ì§„ë£Œê³¼</label>
              <select class="form-select" id="doctorSelect">
                <option value="" selected>-</option>
                <option>ì‹ ê²½ì™¸ê³¼ / ë‚˜ì‹ ê²½ / DN002</option>
                <option>ì •í˜•ì™¸ê³¼ / ì›ì¥ / DO003</option>
                <option>ì •í˜•ì™¸ê³¼ / ê¹€ì˜ì‚¬ / DO001</option>
              </select>
            </div>

            <div class="col-md-7">
              <label class="form-label">ë‚´ì› ì‚¬ìœ </label>
              <textarea class="form-control" id="visitReason"></textarea>
            </div>
          </form>
        </div>

        <div class="modal-footer justify-content-center">
          <button class="btn btn-primary">ì €ì¥</button>
          <button class="btn btn-primary">ì‚­ì œ</button>
          <button class="btn btn-primary">ë¬¸ìë³´ë‚´ê¸°</button>
        </div>
      </div>
    </div>
  </div>

  <!-- âœ… í™˜ì ê²€ìƒ‰ ëª¨ë‹¬ -->
  <div class="modal fade" id="patientSearchModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">í™˜ì ê²€ìƒ‰</h5>
          <button class="btn btn-primary modal-back-btn">ë‹«ê¸°</button>
        </div>
        <div class="modal-body">

          <!-- ê²€ìƒ‰ì°½ -->
          <div class="input-group mb-3">
            <input type="text" id="patientSearchInput" class="form-control" placeholder="í™˜ì ì´ë¦„">
            <button class="btn btn-primary" type="button" id="searchBtn">ê²€ìƒ‰</button>
            <button class="btn btn-outline-secondary" type="button" id="clearSearchBtn">ì´ˆê¸°í™”</button>
          </div>

          <table class="table table-hover mb-0">
            <thead>
              <tr>
                <th>í™˜ìë²ˆí˜¸</th>
                <th>ì´ë¦„</th>
                <th>ì—°ë½ì²˜</th>
                <th>ìµœê·¼ë‚´ì›ì¼</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>6102</td>
                <td>ì´ìŠ¹í¬</td>
                <td>010-1111-2222</td>
                <td>2025-09-03</td>
              </tr>
              <tr>
                <td>5800</td>
                <td>ì´ìŠ¹í¬</td>
                <td>010-2656-5566</td>
                <td>2023-07-05</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="selectPatientBtn">ì„ íƒ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================
       âœ… ì „ì²´ ì˜ˆì•½ ëª©ë¡ ëª¨ë‹¬
  ============================ -->
  <div class="modal fade" id="managerReservationModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content custom-modal-size">
        <div class="modal-header">
          <div class="d-flex gap-2">
            <h5 class="modal-title fw-bold">ì „ì²´ ì˜ˆì•½ ëª©ë¡</h5>
          </div>
          <div>
            <button class="btn btn-primary modal-back-btn">ë‹«ê¸°</button>
          </div>
        </div>

        <div class="modal-body">
          <div class="row mb-3">
            <div class="col-md-3">
              <label class="form-label">ì›”</label>
              <select class="form-select">
                <option>9ì›”</option>
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label">ì£¼</label>
              <select class="form-select">
                <option>9ì›” 15ì¼ ~ 9ì›” 21ì¼</option>
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label">ì¼</label>
              <select class="form-select">
                <option>16ì¼</option>
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label">ì‹œê°„</label>
              <select class="form-select">
                <option>ì „ì²´</option>
              </select>
            </div>
          </div>

          <div class="table-responsive">
            <table id="reservationTable" class="table table-bordered text-center align-middle">
              <thead class="table-light">
                <tr>
                  <th scope="col"><input type="checkbox" id="selectAll"></th>
                  <th scope="col">ì´ë¦„</th>
                  <th scope="col">ë°©ë¬¸ ì˜ˆì • ì¼</th>
                  <th scope="col">ë°©ë¬¸ ì˜ˆì • ì‹œê°„</th>
                  <th scope="col">ë‹´ë‹¹ì˜ì‚¬</th>
                  <th scope="col">ì§„ë£Œê³¼</th>
                  <th scope="col">ìƒì„¸</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><input class="row-check" type="checkbox"></td>
                  <td>ì´ìŠ¹í¬</td>
                  <td>2025-09-16</td>
                  <td>08:30</td>
                  <td>ë‚˜ì‹ ê²½</td>
                  <td>ì‹ ê²½ì™¸ê³¼</td>
                  <td><a href="#" class="detail-link"><img src="detail.png" alt="ìƒì„¸ë³´ê¸°" width="24" height="24"></a></td>
                </tr>
                <tr>
                  <td><input class="row-check" type="checkbox"></td>
                  <td>ì‹¬ì±„ìœ¤</td>
                  <td>2025-09-16</td>
                  <td>09:00</td>
                  <td>ë‚˜ì‹ ê²½</td>
                  <td>ì‹ ê²½ì™¸ê³¼</td>
                  <td><a href="#" class="detail-link"><img src="detail.png" alt="ìƒì„¸ë³´ê¸°" width="24" height="24"></a></td>
                </tr>
                <tr>
                  <td><input class="row-check" type="checkbox"></td>
                  <td>í™©íƒœì¤€</td>
                  <td>2025-09-16</td>
                  <td>10:30</td>
                  <td>í™ê¸¸ë™</td>
                  <td>ì‹ ê²½ì™¸ê³¼</td>
                  <td><a href="#" class="detail-link"><img src="detail.png" alt="ìƒì„¸ë³´ê¸°" width="24" height="24"></a></td>
                </tr>
                <tr>
                  <td><input class="row-check" type="checkbox"></td>
                  <td>ì´ìŠ¹í¬</td>
                  <td>2025-09-16</td>
                  <td>11:00</td>
                  <td>ë‚˜ì‹ ê²½</td>
                  <td>ì‹ ê²½ì™¸ê³¼</td>
                  <td><a href="#" class="detail-link"><img src="detail.png" alt="ìƒì„¸ë³´ê¸°" width="24" height="24"></a></td>
                </tr>
                <tr>
                  <td><input class="row-check" type="checkbox"></td>
                  <td>ê¹€ì°°ìˆ˜</td>
                  <td>2025-09-16</td>
                  <td>14:00</td>
                  <td>ë°•ì„ê°•</td>
                  <td>ì •í˜•ì™¸ê³¼</td>
                  <td><a href="#" class="detail-link"><img src="detail.png" alt="ìƒì„¸ë³´ê¸°" width="24" height="24"></a></td>
                </tr>
                <tr>
                  <td><input class="row-check" type="checkbox"></td>
                  <td>ì‹ ëª…êµ¬</td>
                  <td>2025-09-16</td>
                  <td>15:00</td>
                  <td>ê¹€ì˜ì‚¬</td>
                  <td>ì •í˜•ì™¸ê³¼</td>
                  <td><a href="#" class="detail-link"><img src="detail.png" alt="ìƒì„¸ë³´ê¸°" width="24" height="24"></a></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="modal-footer d-flex justify-content-between">
          <div class="d-flex gap-2">
            <button class="btn btn-primary">ì„ íƒ í™˜ì ë¬¸ì ë³´ë‚´ê¸°</button>
            <button class="btn btn-primary">ì„ íƒ í™˜ì ì˜ˆì•½ ì‚­ì œ</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================
       âœ… ì˜ˆì•½ ìƒì„¸ ëª¨ë‹¬ + ì‚­ì œ í™•ì¸
  ============================ -->
  <div class="modal fade" id="reservationDetailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content custom-modal-size">
        <div class="modal-header">
          <h5 class="modal-title fw-bold">ì˜ˆì•½ ìƒì„¸</h5>
          <button class="btn btn-primary modal-back-btn">ë‹«ê¸°</button>
        </div>

        <div class="modal-body">
          <form id="reservationForm">
            <div class="mb-3 col-md-4">
              <label class="form-label">ì´ë¦„</label>
              <input type="text" id="detailName" class="form-control" readonly>
            </div>

            <div class="mb-3">
              <label class="form-label">ì¼ì‹œ</label>
              <div class="row g-2 align-items-center">
                <div class="col-md-4 col-12">
                  <input type="date" id="visitDate" class="form-control" readonly>
                </div>
                <div class="col-md-3 col-6">
                  <input type="time" id="visitTime" class="form-control" readonly>
                </div>
              </div>
            </div>

            <div class="mb-3 col-md-4">
              <label class="form-label">í™˜ìì—°ë½ì²˜</label>
              <input type="text" id="detailPhone" class="form-control" value="" readonly>
            </div>

            <div class="mb-3 col-md-4">
              <label class="form-label">ë‹´ë‹¹ì˜ì‚¬ / ì§„ë£Œê³¼</label>
              <select id="doctorDept" class="form-select" disabled>
                <option>ì‹ ê²½ì™¸ê³¼ / ë‚˜ì‹ ê²½ / DN002</option>
                <option>ì •í˜•ì™¸ê³¼ / ì›ì¥ / DO003</option>
                <option>ì •í˜•ì™¸ê³¼ / ê¹€ì˜ì‚¬ / DO001</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">ë‚´ì› ì‚¬ìœ </label>
              <!-- ìƒì„¸ ëª¨ë“œìš© input -->
              <input type="text" id="visitReasonInput" class="form-control" value="ìˆ˜ìˆ  ì´í›„ ì†ë°œ ì €ë¦¼" readonly>
              <!-- ìˆ˜ì • ëª¨ë“œìš© textarea -->
              <textarea id="visitReasonTextarea" class="form-control d-none">ìˆ˜ìˆ  ì´í›„ ì†ë°œ ì €ë¦¼</textarea>
            </div>
          </form>
        </div>

        <div class="modal-footer justify-content-center">
          <button id="editBtn" class="btn btn-primary">ìˆ˜ì •</button>
          <button id="saveBtn" class="btn btn-success d-none">ì €ì¥</button>
          <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteConfirmModal">ì‚­ì œ</button>
          <button class="btn btn-secondary">ë©”ì‹œì§€ë³´ë‚´ê¸°</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content text-center border border-danger">
        <div class="modal-body">
          <p class="fs-5 fw-bold text-danger mb-4">ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ!?</p>
          <div class="d-flex justify-content-center gap-3">
            <button type="button" class="btn btn-primary" id="confirmDeleteBtn">í™•ì¸</button>
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- ============================
       âœ… ì‚¬ì´ë“œë°” + ë‹¬ë ¥ + ëª¨ë‹¬ ìŠ¤í¬ë¦½íŠ¸
  ============================ -->
  <script>
  // ---------- ì‚¬ì´ë“œë°” ë¡œë“œ ----------
  async function loadSidebar(activeKey) {
    const slot = document.getElementById('sidebar-slot');
    try {
      const resp = await fetch('./sidebar.html');
      const html = await resp.text();
      slot.innerHTML = html;
      const current = slot.querySelector(`[data-route="${activeKey}"]`);
      if (current) {
        slot.querySelectorAll('#sidebar-nav .nav-link').forEach(a=>{
          a.classList.remove('active','bg-primary','text-white');
          a.classList.add('text-dark');
        });
        current.classList.add('active','bg-primary','text-white');
        current.classList.remove('text-dark');
      }
    } catch (e) {
      // ì‚¬ì´ë“œë°” íŒŒì¼ì´ ì—†ì„ ìˆ˜ë„ ìˆìœ¼ë‹ˆ ì¡°ìš©íˆ ë¬´ì‹œ
    }
  }
  loadSidebar('reserve');

  /* ì˜ˆì•½ ë°ì´í„° (ì˜ˆì‹œ) */
  const reservationEvents = {
    "2025-09-16": [
      { start: "09:00", end: "09:30", title: "ê³ ì€ë‹˜ 9:00" },
      { start: "14:00", end: "14:30", title: "ì´ìˆ˜í˜„ 14:00" }
    ],
    "2025-09-15": [
      { start: "10:00", end: "11:00", title: "ì‹¬ë°• ê²€ì‚¬" }
    ]
  };

  /* ì „ì—­ ìƒíƒœ */
  let viewMode = 'month';
  let viewDate = new Date(); viewDate.setDate(1);

  function fmt(date) {
    const y = date.getFullYear();
    const m = String(date.getMonth()+1).padStart(2,'0');
    const d = String(date.getDate()).padStart(2,'0');
    return `${y}-${m}-${d}`;
  }
  function startOfWeekMonday(d) {
    const dt = new Date(d);
    const day = dt.getDay();
    const diff = (day === 0 ? -6 : 1 - day);
    dt.setDate(dt.getDate() + diff);
    dt.setHours(0,0,0,0);
    return dt;
  }
  function addDays(d, n) { const dt = new Date(d); dt.setDate(dt.getDate() + n); return dt; }

  const container = document.getElementById('container');
  const ymSpan = document.getElementById('ym');

  function render() {
    if (viewMode === 'month') renderMonth();
    else if (viewMode === 'week') renderWeek();
    else renderDay();
  }

  /* âœ… Month View */
  function renderMonth() {
    const year = viewDate.getFullYear();
    const month = viewDate.getMonth();
    ymSpan.textContent = `${year}ë…„ ${month + 1}ì›”`;

    let firstDay = new Date(year, month, 1).getDay();
    if (firstDay === 0) firstDay = 7;
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    const days = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'];

    let html = '<table class="table table-bordered text-center align-middle month-view"><thead><tr>';
    for (const d of days) html += `<th>${d}</th>`;
    html += '</tr></thead><tbody>';

    let day = 1;
    let started = false;

    for (let r = 0; r < 6 && day <= daysInMonth; r++) {
      html += '<tr>';
      for (let c = 1; c <= 7; c++) {
        if (!started && c < firstDay) {
          html += '<td></td>';
        } else if (day > daysInMonth) {
          html += '<td></td>';
        } else {
          const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
          const count = (reservationEvents[dateKey] || []).length;
          html += `<td><strong>${day}</strong><small>ì´ ì˜ˆì•½ ${count}ê±´</small></td>`;
          day++;
          started = true;
        }
      }
      html += '</tr>';
    }

    html += '</tbody></table>';
    container.innerHTML = html;
  }

  /* âœ… Week View */
  function renderWeek() {
    const monday = startOfWeekMonday(viewDate);
    const weekDays = [];
    for (let i = 0; i < 7; i++) weekDays.push(addDays(monday, i));
    ymSpan.textContent = `${fmt(weekDays[0])} ~ ${fmt(weekDays[6])}`;

    const hours = []; for (let h = 7; h <= 19; h++) hours.push(h);

    let html = '<table class="table table-bordered text-center align-middle week-view"><thead><tr><th>ì‹œê°„</th>';
    for (let d of weekDays) {
      const dayLabel = d.toLocaleDateString('ko-KR', { weekday: 'short' });
      html += `<th>${dayLabel} (${d.getMonth() + 1}/${d.getDate()})</th>`;
    }
    html += '</tr></thead><tbody>';

    for (let h of hours) {
      html += '<tr>';
      html += `<td>${String(h).padStart(2,'0')}:00</td>`;
      for (let d of weekDays) {
        const key = fmt(d);
        const evs = reservationEvents[key] || [];
        const count = evs.filter(e => e.start.startsWith(String(h).padStart(2, '0'))).length;
        html += `<td>${count > 0 ? `<span class="text-danger fw-bold">ì˜ˆì•½ ${count}ê±´</span>` : ''}</td>`;
      }
      html += '</tr>';
    }

    // ì¼ë³„ í•©ê³„
    html += '<tr>';
    html += `<td class="fw-bold bg-light">ì´ ì˜ˆì•½</td>`;
    for (let d of weekDays) {
      const key = fmt(d);
      const total = (reservationEvents[key] || []).length;
      html += `<td class="bg-light fw-bold">ì´ ì˜ˆì•½ ${total}ê±´</td>`;
    }
    html += '</tr>';

    html += '</tbody></table>';
    container.innerHTML = html;
  }

  /* âœ… Day View */
  function renderDay() {
    const key = fmt(viewDate);
    ymSpan.textContent = key;

    const hours = []; for (let h=7; h<=19; h++) hours.push(h);

    let html = '<table class="table table-bordered text-center align-middle day-view"><thead><tr><th>ì‹œê°„</th><th>ì˜ˆì•½</th></tr></thead><tbody>';
    for (let h of hours) {
      const evs = (reservationEvents[key]||[]).filter(e => e.start.startsWith(String(h).padStart(2,'0')));
      html += `<tr><td>${String(h).padStart(2,'0')}:00</td><td>${evs.map(e=>`${e.start}-${e.end} ${e.title}`).join('<br>')}</td></tr>`;
    }
    html += '</tbody></table>';
    container.innerHTML = html;
  }

  /* âœ… ë“œë¡­ë‹¤ìš´ ì´ë²¤íŠ¸ */
  const viewSelect = document.getElementById('viewSelect');
  viewSelect.addEventListener('change', () => { viewMode = viewSelect.value; render(); });

  /* âœ… ì´ì „ / ë‹¤ìŒ ë²„íŠ¼ */
  document.getElementById('prev').onclick = ()=>{
    if (viewMode==='month') viewDate.setMonth(viewDate.getMonth()-1);
    else if (viewMode==='week') viewDate.setDate(viewDate.getDate()-7);
    else if (viewMode==='day') viewDate.setDate(viewDate.getDate()-1);
    render();
  };
  document.getElementById('next').onclick = ()=>{
    if (viewMode==='month') viewDate.setMonth(viewDate.getMonth()+1);
    else if (viewMode==='week') viewDate.setDate(viewDate.getDate()+7);
    else if (viewMode==='day') viewDate.setDate(viewDate.getDate()+1);
    render();
  };

  /* âœ… ìµœì´ˆ ë Œë” */
  render();



  // ============================
  // ğŸ”¥ ëª¨ë‹¬ ë‚´ë¹„ê²Œì´ì…˜ ìŠ¤íƒ ì²˜ë¦¬
  //   - modal-back-btn í´ë¦­ ì‹œ "ì§ì „ ëª¨ë‹¬" ë³µê·€
  //   - ì²« ì§„ì…ì´ë©´ ê·¸ëƒ¥ ë‹«í˜(í˜ì´ì§€ë¡œ ë³µê·€)
  // ============================
  const modalStack = []; // ['reservationModal', 'patientSearchModal', ...]
  function showModal(id, fromId /* string or null */) {
    if (fromId) modalStack.push(fromId);
    const el = document.getElementById(id);
    const m = bootstrap.Modal.getOrCreateInstance(el, {backdrop: 'static', keyboard: false});
    m.show();
  }
  function hideModal(id) {
    const el = document.getElementById(id);
    const m = bootstrap.Modal.getInstance(el);
    if (m) m.hide();
  }
  function currentOpenModalId(btnEl) {
    const modalEl = btnEl.closest('.modal');
    return modalEl ? modalEl.id : null;
  }
  function modalBack(btnEl) {
    const currId = currentOpenModalId(btnEl);
    if (!currId) return;
    hideModal(currId);
    const prev = modalStack.pop();
    if (prev) {
      // ì´ì „ì´ í˜ì´ì§€ë©´ ì•„ë¬´ê²ƒë„ ì•ˆ ë„ì›€
      if (prev !== 'PAGE') {
        showModal(prev, null);
      }
    }
  }

  // ëª¨ë“  ë‹«ê¸° ë²„íŠ¼ì— ê³µí†µ ë°”ì¸ë”©
  document.querySelectorAll('.modal-back-btn').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      e.preventDefault();
      modalBack(btn);
    });
  });

  // ëª¨ë‹¬ì´ ë°±ë“œë¡­ ë“±ìœ¼ë¡œ ë‹«íŒ ê²½ìš°ì—ë„ ìŠ¤íƒ ë³µê·€ ë™ì‘
  document.querySelectorAll('.modal').forEach(modalEl=>{
    modalEl.addEventListener('hidden.bs.modal', ()=>{
      // ë‹«íŒ ë’¤ ì§ì „ ëª¨ë‹¬ ë³µì› (ë‹¨, ë²„íŠ¼ì„ í†µí•œ ëª…ì‹œì  backì—ì„œë„ í•œ ë²ˆ ë” í˜¸ì¶œë  ìˆ˜ ìˆìœ¼ë‹ˆ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬)
      if (document.querySelector('.modal.show')) return; // ì´ë¯¸ ë‹¤ë¥¸ ëª¨ë‹¬ì´ ë– ìˆìœ¼ë©´ ë¬´ì‹œ
      const prev = modalStack.pop();
      if (prev && prev !== 'PAGE') showModal(prev, null);
    });
  });

  // ============================
  // âœ… í™˜ì ê²€ìƒ‰ ëª¨ë‹¬ ë¡œì§
  // ============================
  (function initPatientSearch(){
    let selectedRow = null;

    // í–‰ ì„ íƒ
    document.querySelectorAll("#patientSearchModal tbody tr").forEach(row => {
      row.addEventListener("click", () => {
        if (selectedRow) selectedRow.classList.remove("table-active");
        row.classList.add("table-active");
        selectedRow = row;
      });
    });

    // ì„ íƒ ë²„íŠ¼ -> ê°’ ì „ë‹¬ í›„ ê²€ìƒ‰ëª¨ë‹¬ ë‹«ê³  ì˜ˆì•½ë“±ë¡ ëª¨ë‹¬ ë³µê·€
    document.getElementById("selectPatientBtn").addEventListener("click", () => {
      if (selectedRow) {
        const cells = selectedRow.querySelectorAll("td");
        const name = cells[1].innerText;
        const phone = cells[2].innerText;
        document.getElementById("patientName").value = name;
        document.getElementById("patientPhone").value = phone;

        hideModal("patientSearchModal");
        showModal("reservationModal", null); // ì´ì „ ëª¨ë‹¬ ë‹¤ì‹œ ì—´ê¸°
      }
    });

    // ê²€ìƒ‰
    const searchPatients = () => {
      const keyword = document.getElementById("patientSearchInput").value.trim();
      const rows = document.querySelectorAll("#patientSearchModal tbody tr");
      rows.forEach(row => {
        const name = row.querySelectorAll("td")[1].innerText.trim();
        row.style.display = (keyword === "" || name.includes(keyword)) ? "" : "none";
      });
    };
    document.getElementById("searchBtn").addEventListener("click", searchPatients);
    document.getElementById("patientSearchInput").addEventListener("keydown", (event) => {
      if (event.key === "Enter") {
        event.preventDefault();
        searchPatients();
      }
    });
    document.getElementById("clearSearchBtn").addEventListener("click", () => {
      document.getElementById("patientSearchInput").value = "";
      document.querySelectorAll("#patientSearchModal tbody tr").forEach(row => row.style.display = "");
    });

    // "í™˜ì ì¡°íšŒ" ë²„íŠ¼ì„ ëˆŒëŸ¬ ê²€ìƒ‰ ëª¨ë‹¬ ì—´ ë•Œ ìŠ¤íƒ ì²˜ë¦¬ (ì˜ˆì•½ë“±ë¡ -> í™˜ìê²€ìƒ‰)
    document.querySelectorAll('[data-bs-target="#patientSearchModal"]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        modalStack.push('reservationModal');
      });
    });
  })();


  // ============================
  // âœ… ì˜ˆì•½ ëª©ë¡(ì²´í¬ë°•ìŠ¤) ë¡œì§
  // ============================
  (function initManagerList(){
    const selectAll = document.getElementById("selectAll");
    const rowChecks = document.querySelectorAll(".row-check");

    if (selectAll) {
      selectAll.addEventListener("change", function () {
        rowChecks.forEach((checkbox) => { checkbox.checked = selectAll.checked; });
      });
      rowChecks.forEach((checkbox) => {
        checkbox.addEventListener("change", function () {
          const allChecked = [...rowChecks].every((chk) => chk.checked);
          selectAll.checked = allChecked;
        });
      });
    }

    // ìƒì„¸ ì•„ì´ì½˜ í´ë¦­ -> ìƒì„¸ ëª¨ë‹¬ë¡œ ì´ë™ (ìŠ¤íƒ: ëª©ë¡ -> ìƒì„¸)
    document.getElementById('reservationTable')?.addEventListener('click', (e)=>{
      const a = e.target.closest('.detail-link');
      if (!a) return;
      e.preventDefault();

      const tr = a.closest('tr');
      const tds = tr.querySelectorAll('td');

      // í‘œì—ì„œ ì •ë³´ ì¶”ì¶œ
      const name  = tds[1].innerText.trim();
      const date  = tds[2].innerText.trim();
      const time  = tds[3].innerText.trim();
      const doc   = tds[4].innerText.trim();
      const dept  = tds[5].innerText.trim();

      // ìƒì„¸ ëª¨ë‹¬ì— ì£¼ì…
      document.getElementById('detailName').value = name;
      document.getElementById('visitDate').value  = date;
      document.getElementById('visitTime').value  = time.padStart(5, '0'); // 8:30 -> 08:30
      document.getElementById('detailPhone').value = ''; // í•„ìš” ì‹œ ëª©ë¡ì— 'ì—°ë½ì²˜' ì»¬ëŸ¼ ì¶”ê°€í•´ ì£¼ì…

      // ë‹´ë‹¹ì˜ì‚¬/ì§„ë£Œê³¼ ì„ íƒê°’(ê°„ë‹¨ ë§¤ì¹­)
      const doctorSelect = document.getElementById('doctorDept');
      const options = [...doctorSelect.options].map(o=>o.textContent.trim());
      const targetText = `${dept} / ${doc}`;
      let matched = options.findIndex(t => t.includes(dept) && t.includes(doc));
      doctorSelect.selectedIndex = matched >= 0 ? matched : 0;

      // ìŠ¤íƒ: ëª©ë¡ -> ìƒì„¸
      modalStack.push('managerReservationModal');
      showModal('reservationDetailModal', null);
    });
  })();


  // ============================
  // âœ… ì˜ˆì•½ ìƒì„¸ ëª¨ë‹¬: ìˆ˜ì •/ì €ì¥/ì‚­ì œ
  // ============================
  (function initDetailModal(){
    const editBtn = document.getElementById("editBtn");
    const saveBtn = document.getElementById("saveBtn");
    const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");

    const dateInput = document.getElementById("visitDate");
    const timeInput = document.getElementById("visitTime");
    const doctorSelect = document.getElementById("doctorDept");

    const reasonInput = document.getElementById("visitReasonInput");
    const reasonTextarea = document.getElementById("visitReasonTextarea");

    editBtn.addEventListener("click", (e) => {
      e.preventDefault();
      dateInput.removeAttribute("readonly");
      timeInput.removeAttribute("readonly");
      doctorSelect.removeAttribute("disabled");

      reasonInput.classList.add("d-none");
      reasonTextarea.classList.remove("d-none");
      reasonTextarea.value = reasonInput.value;

      document.querySelector("#reservationDetailModal .modal-title").innerText = "ì˜ˆì•½ ìˆ˜ì •";
      editBtn.classList.add("d-none");
      saveBtn.classList.remove("d-none");
    });

    saveBtn.addEventListener("click", (e) => {
      e.preventDefault();
      dateInput.setAttribute("readonly", true);
      timeInput.setAttribute("readonly", true);
      doctorSelect.setAttribute("disabled", true);

      reasonInput.value = reasonTextarea.value;
      reasonTextarea.classList.add("d-none");
      reasonInput.classList.remove("d-none");

      document.querySelector("#reservationDetailModal .modal-title").innerText = "ì˜ˆì•½ ìƒì„¸";
      saveBtn.classList.add("d-none");
      editBtn.classList.remove("d-none");

      alert("ì˜ˆì•½ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    });

    confirmDeleteBtn.addEventListener("click", () => {
      const deleteModal = bootstrap.Modal.getInstance(document.getElementById("deleteConfirmModal"));
      deleteModal.hide();
      alert("ì˜ˆì•½ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
      // ì‹¤ì œ ì‚­ì œ ë¡œì§ ì—°ê²° ê°€ëŠ¥
    });
  })();


  // ============================
  // âœ… ì²« ì§„ì…ì—ì„œ ë²„íŠ¼ìœ¼ë¡œ ëª¨ë‹¬ ì—¬ëŠ” ê²½ìš° ìŠ¤íƒì— 'PAGE' í‘¸ì‹œ
  //    (ë‹«ê¸° ëˆ„ë¥´ë©´ í˜ì´ì§€ë¡œ ë³µê·€ = ì•„ë¬´ ëª¨ë‹¬ë„ ì•ˆ ë„ì›€)
  // ============================
  document.querySelectorAll('[data-bs-target="#reservationModal"]').forEach(btn=>{
    btn.addEventListener('click', ()=> modalStack.push('PAGE'));
  });
  document.querySelectorAll('[data-bs-target="#managerReservationModal"]').forEach(btn=>{
    btn.addEventListener('click', ()=> modalStack.push('PAGE'));
  });
  </script>
</body>
</html>
