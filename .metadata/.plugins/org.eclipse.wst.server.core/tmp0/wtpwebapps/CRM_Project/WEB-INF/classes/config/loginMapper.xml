<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="loginMapper">
	<select id="login" parameterType="map" resultType="map">
	    select authority from employee
	    where employee_id = #{employeeId} and #{pw} and del_flag is null
	</select>

	<insert id="insertLog" parameterType="map">
	    insert into login_log (login_no, employee_id, login_ip, login_date)
	    values (login_no.nextval, #{employeeId}, #{loginIp}, sysdate)
	</insert>


	<select id="selectAuthority" parameterType="string" resultType="String">
		select authority from employee where employee_id = #{employeeId}
	</select> 

	<select id="selectLoginLog" parameterType="string" resultType="map">
		select e.employee_name, e.position, ll.login_ip, to_char(ll.login_date, 'YYYY/MM/DD HH24:MI:SS') AS login_date
		from login_log ll
		join employee e on e.employee_id = ll.employee_id
		where e.employee_id = #{employeeId}
		  and ll.login_date = (
		        select MAX(login_date)
		        from login_log
		        where employee_id = #{employeeId}
      )
	</select>
	
</mapper>
