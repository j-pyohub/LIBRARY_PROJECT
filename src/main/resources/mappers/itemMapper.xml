<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.erp.dao.ItemDAO">

    <!-- ResultMap -->
    <resultMap id="ItemMap" type="com.erp.repository.entity.Item">
        <id property="itemNo" column="item_no"/>
        <result property="itemCode" column="item_code"/>
        <result property="itemCategory" column="item_category"/>
        <result property="itemName" column="item_name"/>
        <result property="ingredientName" column="ingredient_name"/>
        <result property="stockUnit" column="stock_unit"/>
        <result property="supplyUnit" column="supply_unit"/>
        <result property="supplier" column="supplier"/>
        <result property="itemPrice" column="item_price"/>
        <result property="convertStock" column="convert_stock"/>
        <result property="storageType" column="storage_type"/>
        <result property="expirationType" column="expiration_type"/>
        <result property="expiration" column="expiration"/>
        <result property="itemImage" column="item_image"/>
        <result property="note" column="note"/>
        <result property="inDate" column="in_date"/>
        <result property="editDate" column="edit_date"/>
        <result property="delDate" column="del_date"/>
    </resultMap>


    <insert id="addItem" parameterType="com.erp.repository.entity.Item" useGeneratedKeys="true" keyProperty="itemNo">
        INSERT INTO ITEM
        (item_code, item_category, item_name, ingredient_name, stock_unit, supply_unit,
         supplier, item_price, convert_stock, storage_type, expiration_type, expiration,
         item_image, note, in_date)
        VALUES
            (#{itemCode}, #{itemCategory}, #{itemName}, #{ingredientName}, #{stockUnit}, #{supplyUnit},
             #{supplier}, #{itemPrice}, #{convertStock}, #{storageType}, #{expirationType}, #{expiration},
             #{itemImage}, #{note}, NOW())
    </insert>




    <update id="setItem" parameterType="com.erp.repository.entity.Item">
        UPDATE ITEM
        SET
            item_category = #{itemCategory},
            item_code = #{itemCode},
            item_name = #{itemName},
            ingredient_name = #{ingredientName},
            stock_unit = #{stockUnit},
            supply_unit = #{supplyUnit},
            convert_stock = #{convertStock},
            item_price = #{itemPrice},
            supplier = #{supplier},
            storage_type = #{storageType},
            expiration_type = #{expirationType},
            expiration = #{expiration},
            item_image = #{itemImage},
            note = #{note},
            edit_date = NOW()
        WHERE item_no = #{itemNo}
    </update>



    <update id="removeItem">
        UPDATE ITEM
        SET del_date = NOW()
        WHERE item_no = #{itemNo}
    </update>


    <select id="getItemList" resultMap="ItemMap">
        SELECT *
        FROM ITEM
        WHERE del_date IS NULL
        ORDER BY item_no DESC
    </select>



    <select id="getByCategory" resultMap="ItemMap">
        SELECT *
        FROM ITEM
        WHERE del_date IS NULL
          AND item_category LIKE CONCAT('%', #{itemCategory}, '%')
    </select>


    <select id="getByItemName" resultMap="ItemMap">
        SELECT *
        FROM ITEM
        WHERE del_date IS NULL
          AND item_name LIKE CONCAT('%', #{itemName}, '%')
    </select>



    <select id="getByItemCode" resultMap="ItemMap">
        SELECT *
        FROM ITEM
        WHERE del_date IS NULL
          AND item_code LIKE CONCAT('%', #{itemCode}, '%')
    </select>


    <select id="getByIngredient" resultMap="ItemMap">
        SELECT *
        FROM ITEM
        WHERE del_date IS NULL
          AND ingredient_name LIKE CONCAT('%', #{ingredientName}, '%')
    </select>



    <select id="getItemDetail" resultMap="ItemMap">
        SELECT *
        FROM ITEM
        WHERE item_no = #{itemNo}
    </select>

</mapper>
