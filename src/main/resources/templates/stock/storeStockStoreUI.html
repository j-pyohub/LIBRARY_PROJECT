<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>재고 변동 조회 : 가산점</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        body{background:#f8f9fa;}
        .layout-container{max-width:1500px;margin:0 auto;}
        table.stock-table thead{background:#e9ecef!important;}
        table.stock-table th{color:#212529!important;}
        table.stock-table td,table.stock-table th{font-size:.9rem;}
        table.stock-table tbody tr{background:#fff!important;}
        table.stock-table tbody tr:nth-of-type(odd),
        table.stock-table tbody tr:nth-of-type(even){background:#fff!important;}
        .chg-plus{color:#0d6efd;font-weight:700;}
        .chg-minus{color:#dc3545;font-weight:700;}
        .btn-main{background:#FFEEAA;border-color:#FFEEAA;color:#000;}
        .btn-main:hover{background:#f2da84;border-color:#f2da84;color:#000;}
        .filter-label{font-weight:700;font-size:.9rem;display:block;margin-bottom:.25rem;}
        .w-compact{max-width:220px;}
        .w-compact-lg{max-width:320px;}
        .filters .form-select-sm,.filters .form-control-sm{height:31px;}
        .pagination{margin-top:16px;margin-bottom:0;}
    </style>
</head>
<body>

<header th:replace="fragments/toolBarStore :: toolBarStore"></header>

<div class="layout-container py-4 px-3">

    <div class="mb-3">
        <h3 class="fw-bold mb-0">재고 변동 조회 : 가산점</h3>
    </div>

    <!-- 검색 영역 -->
    <div class="card p-3 mb-3 shadow-sm border-0">
        <div class="filters row g-3 align-items-end">
            <div class="col-12 col-md-4">
                <label class="filter-label">기간</label>
                <div class="d-flex align-items-center gap-2">
                    <input type="date" id="dateFrom" class="form-control form-control-sm w-compact-lg">
                    <span class="small">~</span>
                    <input type="date" id="dateTo" class="form-control form-control-sm w-compact-lg">
                </div>
            </div>

            <div class="col-6 col-md-2">
                <label class="filter-label">카테고리</label>
                <select id="categorySelect" class="form-select form-select-sm w-100">
                    <option value="">전체</option><option>도우</option><option>소스</option>
                    <option>치즈</option><option>육류</option><option>야채</option>
                    <option>사이드</option><option>음료</option>
                </select>
            </div>

            <div class="col-6 col-md-2">
                <label class="filter-label">변동유형</label>
                <select id="reasonSelect" class="form-select form-select-sm w-100">
                    <option value="">전체</option>
                    <option value="입고">입고</option><option value="판매">판매</option>
                    <option value="폐기">폐기</option><option value="조정">조정</option>
                </select>
            </div>

            <div class="col-6 col-md-2">
                <label class="filter-label">검색조건</label>
                <select id="searchTypeSelect" class="form-select form-select-sm">
                    <option value="ITEM_NAME">품목명</option>
                    <option value="ITEM_CODE">품목코드</option>
                </select>
            </div>

            <div class="col-6 col-md-2">
                <label class="filter-label">검색어</label>
                <input id="searchKeyword" class="form-control form-control-sm w-compact" placeholder="검색어 입력">
            </div>

            <div class="col-12 col-md-auto">
                <button class="btn btn-sm btn-main px-3">조회</button>
                <button type="button" class="btn btn-sm btn-outline-secondary px-3" id="btnResetFilter">초기화</button>
            </div>
        </div>
    </div>

    <!-- 결과 -->
    <div class="card shadow-sm border-0">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table align-middle mb-0 stock-table bg-white">
                    <thead>
                    <tr class="table-light">
                        <th>변동일시</th>
                        <th>카테고리</th>
                        <th>품목코드</th>
                        <th>품목명</th>
                        <th>변동유형</th>
                        <th class="text-end">변동수량</th>
                        <th class="text-end">현재 재고</th>
                        <th>폐기사유</th>
                    </tr>
                    </thead>
                    <tbody id="stockHistoryBody">
                    <!-- 가산점 샘플 20 -->
                    <tr><td>2025-11-20 10:12</td><td>도우</td><td>DOUGH-M-230G</td><td>도우 M 230g(레귤러)</td><td>입고</td><td class="text-end">+50 ea</td><td class="text-end">120 ea</td><td>-</td></tr>
                    <tr><td>2025-11-20 18:40</td><td>도우</td><td>DOUGH-M-230G</td><td>도우 M 230g(레귤러)</td><td>판매</td><td class="text-end">-24 ea</td><td class="text-end">96 ea</td><td>-</td></tr>
                    <tr><td>2025-11-19 09:30</td><td>소스</td><td>SAUCE-3KG-CAN</td><td>토마토 소스 3kg 캔</td><td>입고</td><td class="text-end">+5 can</td><td class="text-end">18 can</td><td>-</td></tr>
                    <tr><td>2025-11-19 21:05</td><td>소스</td><td>SAUCE-3KG-CAN</td><td>토마토 소스 3kg 캔</td><td>폐기</td><td class="text-end">-1 can</td><td class="text-end">17 can</td><td>유통기한 경과</td></tr>
                    <tr><td>2025-11-18 11:10</td><td>치즈</td><td>MOZZ-2.5KG</td><td>모짜렐라 2.5kg 블록</td><td>입고</td><td class="text-end">+3 EA</td><td class="text-end">11 EA</td><td>-</td></tr>
                    <tr><td>2025-11-18 19:45</td><td>치즈</td><td>MOZZ-2.5KG</td><td>모짜렐라 2.5kg 블록</td><td>판매</td><td class="text-end">-2 EA</td><td class="text-end">9 EA</td><td>-</td></tr>
                    <tr><td>2025-11-17 13:20</td><td>계란</td><td>EGG-30EA</td><td>계란 30구</td><td>폐기</td><td class="text-end">-1 판</td><td class="text-end">14 판</td><td>파손</td></tr>
                    <tr><td>2025-11-17 22:10</td><td>육류</td><td>PEPP-1KG</td><td>페퍼로니 슬라이스 1kg</td><td>판매</td><td class="text-end">-6 pack</td><td class="text-end">21 pack</td><td>-</td></tr>
                    <tr><td>2025-11-16 15:05</td><td>음료</td><td>COKE-1.25L</td><td>콜라 1.25L</td><td>입고</td><td class="text-end">+20 ea</td><td class="text-end">60 ea</td><td>-</td></tr>
                    <tr><td>2025-11-16 22:20</td><td>음료</td><td>COKE-1.25L</td><td>콜라 1.25L</td><td>판매</td><td class="text-end">-12 ea</td><td class="text-end">48 ea</td><td>-</td></tr>
                    <tr><td>2025-11-15 09:20</td><td>야채</td><td>ONION-2KG</td><td>양파 슬라이스 2kg</td><td>입고</td><td class="text-end">+2 bag</td><td class="text-end">8 bag</td><td>-</td></tr>
                    <tr><td>2025-11-15 20:15</td><td>야채</td><td>ONION-2KG</td><td>양파 슬라이스 2kg</td><td>판매</td><td class="text-end">-1 bag</td><td class="text-end">7 bag</td><td>-</td></tr>
                    <tr><td>2025-11-14 11:00</td><td>사이드</td><td>PICKLE-3KG</td><td>피클 3kg 캔</td><td>입고</td><td class="text-end">+3 ea</td><td class="text-end">12 ea</td><td>-</td></tr>
                    <tr><td>2025-11-14 21:40</td><td>사이드</td><td>PICKLE-3KG</td><td>피클 3kg 캔</td><td>판매</td><td class="text-end">-2 ea</td><td class="text-end">10 ea</td><td>-</td></tr>
                    <tr><td>2025-11-13 13:33</td><td>음료</td><td>SODA-500ML</td><td>사이다 500ml</td><td>입고</td><td class="text-end">+30 ea</td><td class="text-end">75 ea</td><td>-</td></tr>
                    <tr><td>2025-11-13 22:12</td><td>음료</td><td>SODA-500ML</td><td>사이다 500ml</td><td>판매</td><td class="text-end">-18 ea</td><td class="text-end">57 ea</td><td>-</td></tr>
                    <tr><td>2025-11-12 10:08</td><td>치즈</td><td>CHED-1KG</td><td>체다 치즈 1kg 슬라이스</td><td>입고</td><td class="text-end">+4 EA</td><td class="text-end">16 EA</td><td>-</td></tr>
                    <tr><td>2025-11-12 21:00</td><td>치즈</td><td>CHED-1KG</td><td>체다 치즈 1kg 슬라이스</td><td>판매</td><td class="text-end">-3 EA</td><td class="text-end">13 EA</td><td>-</td></tr>
                    <tr><td>2025-11-11 12:25</td><td>사이드</td><td>DIP-GARLIC</td><td>갈릭 디핑 소스 20g</td><td>입고</td><td class="text-end">+50 ea</td><td class="text-end">140 ea</td><td>-</td></tr>
                    <tr><td>2025-11-11 21:55</td><td>사이드</td><td>DIP-GARLIC</td><td>갈릭 디핑 소스 20g</td><td>판매</td><td class="text-end">-35 ea</td><td class="text-end">105 ea</td><td>-</td></tr>
                    </tbody>
                </table>
            </div>

            <nav class="mt-3 mb-3">
                <ul class="pagination justify-content-center" id="pager">
                    <li class="page-item"><a class="page-link" href="#" data-page="first">&laquo;</a></li>
                    <li class="page-item"><a class="page-link" href="#" data-page="prev">&lt;</a></li>
                    <li class="page-item"><a class="page-link" href="#" data-page="1">1</a></li>
                    <li class="page-item"><a class="page-link" href="#" data-page="2">2</a></li>
                    <li class="page-item"><a class="page-link" href="#" data-page="next">&gt;</a></li>
                    <li class="page-item"><a class="page-link" href="#" data-page="last">&raquo;</a></li>
                </ul>
            </nav>
        </div>
    </div>

</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function paintPlusMinus($root){
        $root.find("td.text-end").each(function(){
            const t=$(this).text().trim(); $(this).removeClass("chg-plus chg-minus");
            if(/^\\+/.test(t)) $(this).addClass("chg-plus");
            if(/^\\-/.test(t)) $(this).addClass("chg-minus");
        });
    }

    // 테이블 페이징
    (function(){
        const rowsPerPage=10;
        const $rows=$("#stockHistoryBody tr");
        const totalRows=$rows.length;
        const totalPages=Math.ceil(totalRows/rowsPerPage)||1;
        let currentPage=1;

        function show(p){
            currentPage=p;
            $rows.addClass("d-none");
            const s=(p-1)*rowsPerPage,e=s+rowsPerPage;
            $rows.slice(s,e).removeClass("d-none");
            paintPlusMinus($("#stockHistoryBody"));
        }
        function update(){
            const $p=$("#pager");
            $p.find(".page-item").removeClass("active disabled");
            $p.find(`a[data-page='${currentPage}']`).parent().addClass("active");
            if(currentPage===1){$p.find("a[data-page='first'],a[data-page='prev']").parent().addClass("disabled");}
            if(currentPage===totalPages){$p.find("a[data-page='last'],a[data-page='next']").parent().addClass("disabled");}
        }
        $("#pager").on("click","a.page-link",function(e){
            e.preventDefault();
            const act=$(this).data("page"); const $pi=$(this).parent();
            if($pi.hasClass("disabled")||$pi.hasClass("active")) return;
            if(act==="first") show(1);
            else if(act==="prev") show(Math.max(1,currentPage-1));
            else if(act==="next") show(Math.min(totalPages,currentPage+1));
            else if(act==="last") show(totalPages);
            else{ const n=parseInt(act,10); if(!isNaN(n)) show(n); }
            update();
        });

        show(1); update();
    })();

    $("#btnResetFilter").on("click", function(){
        $("#dateFrom,#dateTo").val("");
        $("#categorySelect,#reasonSelect").val("");
        $("#searchTypeSelect").val("ITEM_NAME");
        $("#searchKeyword").val("");
    });

    // 최초 컬러링
    paintPlusMinus($("#stockHistoryBody"));
</script>
</body>
</html>
