<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>매출관리 SPA</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <style>
        body { background-color:#fdfdfd; }
        .top-bar { background:#7be3a4; padding:8px 16px; }
        .kpi-card { background:#fff; border:1px solid #ccc; border-radius:10px; padding:18px; text-align:center; }
        .kpi-title { font-size:14px; }
        .kpi-value { font-size:22px; font-weight:600; }
        .section-box { background:#fff; border:1px solid #ddd; border-radius:10px; padding:20px; }
        #listPage { display:none; }
    </style>
</head>

<body class="p-2">

<div class="border border-primary p-2" style="max-width:1500px;margin:0 auto;">



    <!-- 보기 -->
    <div class="mt-3 px-2">
        <div class="d-flex align-items-center mb-2">
            <span class="me-2">보기</span>
            <div class="btn-group">
                <button id="chartBtn" class="btn btn-warning btn-sm">차트</button>
                <button id="listBtn" class="btn btn-outline-secondary btn-sm" >목록</button>
            </div>
        </div>
    </div>

    <!-- ===============================
         CHART PAGE
    =============================== -->
    <div id="chartPage">

        <!-- 라디오 + 조회기간 -->
        <div class="d-flex align-items-center flex-wrap gap-3 mb-3 px-2">

            <!-- 라디오 -->
            <div>
                <label class="form-check form-check-inline">
                    <input type="radio" name="period" id="day" class="form-check-input"><span>일별</span>
                </label>

                <label class="form-check form-check-inline">
                    <input type="radio" name="period" id="week" class="form-check-input"><span>주별</span>
                </label>

                <label class="form-check form-check-inline">
                    <input type="radio" name="period" id="month" class="form-check-input" checked><span>월별</span>
                </label>

                <label class="form-check form-check-inline">
                    <input type="radio" name="period" id="year" class="form-check-input"><span>연별</span>
                </label>
            </div>

            <!-- 조회기간 -->
            <div class="d-flex align-items-center gap-2">
                <span class="fw-semibold">조회기간</span>

                <div id="periodInputs" class="d-flex align-items-center gap-2">
                    <input id="startInput" type="month" class="form-control form-control-sm" style="width:150px;">
                    <span>~</span>
                    <input id="endInput" type="month" class="form-control form-control-sm" style="width:150px;">
                </div>

                <button id="getSalesBtn" class="btn btn-primary btn-sm">조회</button>
            </div>
        </div>

        <!-- KPI -->
        <div class="row g-3 mb-3 px-2">
            <div class="col-md-3"><div class="kpi-card"><div class="kpi-title">전체 매출</div><div class="kpi-value">450,000,000</div></div></div>
            <div class="col-md-3"><div class="kpi-card"><div class="kpi-title">총 판매 수량</div><div class="kpi-value">120,000</div></div></div>
            <div class="col-md-3"><div class="kpi-card"><div class="kpi-title">평균 직영점 매출</div><div class="kpi-value">30,400</div></div></div>
            <div class="col-md-3"><div class="kpi-card"><div class="kpi-title kpi-compare">전월 대비 매출 성장</div><div class="kpi-value">5%</div></div></div>
        </div>

        <!-- 메인 차트 -->
        <div class="section-box mx-2 mb-4">
            <h6 class="fw-bold mb-3">전체 매출 추이</h6>
            <canvas id="mainChart" height="90"></canvas>
        </div>

        <!-- 서브 차트 -->
        <div class="row g-3 mb-3 px-2">
            <div class="col-md-6">
                <div class="section-box">
                    <h6 class="fw-bold mb-3">지점별 매출 TOP 5</h6>
                    <canvas id="storeSalesTop5Chart" height="130"></canvas>
                </div>
            </div>

            <div class="col-md-6">
                <div class="section-box">
                    <h6 class="fw-bold mb-3">메뉴별 매출 비중</h6>
                    <canvas id="menuCountChart" height="130"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- ===============================
         LIST PAGE
    =============================== -->
    <div id="listPage">

        <!-- 조회 + 검색 -->
        <div class="px-3 pt-3">
            <div class="d-flex flex-wrap align-items-center gap-2 mb-3">
                <span class="fw-semibold me-1">조회기간</span>
                <input type="date" class="form-control form-control-sm" style="width:150px;">
                <span>~</span>
                <input type="date" class="form-control form-control-sm" style="width:150px;">

                <span class="fw-semibold ms-3">직영점명</span>
                <div class="input-group input-group-sm" style="width:230px;">
                    <input type="text" class="form-control" placeholder="직영점명">
                    <button id= "salesGetBtn"class="btn btn-outline-secondary btn-sm" type="button">검색</button>                </div>
            </div>
        </div>

        <!-- 리스트 -->
        <div class="px-3 pb-3">
            <div class="section-box">
                <table class="table table-hover align-middle mb-3">
                    <thead>
                    <tr class="text-center">
                        <th>번호</th>
                        <th>직영점명</th>
                        <th>지역</th>
                        <th>전일대비</th>
                        <th>주문수</th>
                        <th>매출액</th>
                        <th>판매날짜</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody id="storeTable"></tbody>
                </table>

                <div class="d-flex justify-content-center mb-3" id="paginationArea"></div>

                <div class="d-flex justify-content-end">
                    <select id="pageSize" class="form-select form-select-sm" style="width:80px;">
                        <option value="5" selected>5개</option>
                        <option value="10">10개</option>
                    </select>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- ==================================================
     SCRIPT
================================================== -->
<script>
    $("#chartBtn").on("click", function () {
        showChart();
    });

    $("#listBtn").on("click", function () {
        showList();
    });
    /* ======================================
       화면 모드 변경
    ====================================== */
    function updateModeButtons(mode) {
        const btnChart = $("#btnChart");
        const btnList = $("#btnList");

        if (mode === "chart") {
            btnChart.addClass("btn-warning").removeClass("btn-outline-secondary");
            btnList.addClass("btn-outline-secondary").removeClass("btn-warning");
        } else {
            btnList.addClass("btn-warning").removeClass("btn-outline-secondary");
            btnChart.addClass("btn-outline-secondary").removeClass("btn-warning");
        }
    }

    function showChart() {
        $("#chartPage").show();
        $("#listPage").hide();
        updateModeButtons("chart");
    }

    function showList() {
        $("#chartPage").hide();
        $("#listPage").show();
        updateModeButtons("list");
    }

    /* ======================================
       초기 실행
    ====================================== */
    $(document).ready(function() {
        showChart();
        updatePeriodInputs("month");
    });

    /* ======================================
       KPI 제목 변경
    ====================================== */
    function updateKpiTitle(period) {
        const t = $(".kpi-compare");

        if (period==="day") t.text("전일 대비 매출 성장");
        if (period==="week") t.text("전주 대비 매출 성장");
        if (period==="month") t.text("전월 대비 매출 성장");
        if (period==="year") t.text("전년 대비 매출 성장");
    }

    /* ======================================
       조회기간 input 변경
    ====================================== */
    function updatePeriodInputs(type) {
        const box = $("#periodInputs");

        if (type==="day") {
            box.html(`
            <input id="startInput" type="date" class="form-control form-control-sm" style="width:150px;">
            <span>~</span>
            <input id="endInput" type="date" class="form-control form-control-sm" style="width:150px;">
        `);
        }

        if (type==="week") {
            box.html(`
            <input id="startInput" type="week" class="form-control form-control-sm" style="width:150px;">
            <span>~</span>
            <input id="endInput" type="week" class="form-control form-control-sm" style="width:150px;">
        `);
        }

        if (type==="month") {
            box.html(`
            <input id="startInput" type="month" class="form-control form-control-sm" style="width:150px;">
            <span>~</span>
            <input id="endInput" type="month" class="form-control form-control-sm" style="width:150px;">
        `);
        }

        if (type==="year") {
            box.html(`
            <input id="startInput" type="number" class="form-control form-control-sm" style="width:120px;" placeholder="연도 입력">
            <span>~</span>
            <input id="endInput" type="number" class="form-control form-control-sm" style="width:120px;" placeholder="연도 입력">
        `);
        }

        applyMinMax();
    }

    /* ======================================
       날짜 역순 방지
    ====================================== */
    function applyMinMax() {
        const s = $("#startInput");
        const e = $("#endInput");

        if (!s.length || !e.length) return;

        s.on("change", function() {
            e.attr("min", s.val());
            if (e.val() && e.val() < s.val()) e.val(s.val());
        });

        e.on("change", function() {
            s.attr("max", e.val());
            if (s.val() && s.val() > e.val()) s.val(e.val());
        });
    }

    /* ======================================
       라디오 change 이벤트
    ====================================== */
    $("input[name='period']").on("change", function() {
        const id = $(this).attr("id");
        updatePeriodInputs(id);
        updateKpiTitle(id);
    });


    /* ================================
       메인 차트
    ================================ */
    let mainChart;

    function createMainChart(labels) {
        const data = labels.map(() => Math.floor(Math.random()*100));
        const ctx = $("#mainChart")[0].getContext("2d");

        if (mainChart) mainChart.destroy();

        mainChart = new Chart(ctx, {
            type:"line",
            data:{
                labels:labels,
                datasets:[{
                    label:"매출액",
                    data:data,
                    borderColor:"#007bff",
                    backgroundColor:"rgba(0,123,255,0.15)",
                    borderWidth:2,
                    fill:true
                }]
            }
        });
    }

    /* ======================================
       조회 버튼
    ====================================== */
    $("#getSalesBtn").on("click", function() {

        const type = $("input[name='period']:checked").attr("id");
        let s = $("#startInput").val();
        let e = $("#endInput").val();

        if (!s && !e) {
            alert("조회기간 중 최소 하나는 입력해야 합니다.");
            return;
        }

        let start = s;
        let end = e;

        const today = new Date();
        const y = today.getFullYear();
        const m = String(today.getMonth()+1).padStart(2,"0");
        const d = String(today.getDate()).padStart(2,"0");

        if (!start) {
            if (type==="day"||type==="week") start="2000-01-01";
            if (type==="month") start="2000-01";
            if (type==="year") start="2000";
        }

        if (!end) {
            if (type==="day"||type==="week") end=`${y}-${m}-${d}`;
            if (type==="month") end=`${y}-${m}`;
            if (type==="year") end=`${y}`;
        }

        let labels = [];

        /* ========== day ========== */
        if (type==="day") {
            let cur = new Date(start), last = new Date(end);
            while(cur <= last){
                labels.push(`${cur.getMonth()+1}/${cur.getDate()}`);
                cur.setDate(cur.getDate()+1);
            }
        }

        /* ========== week ========== */
        if (type==="week") {
            const [sy, sw] = start.split("-W").map(Number);
            const [ey, ew] = end.split("-W").map(Number);

            for(let yy=sy; yy<=ey; yy++){
                const minW = yy === sy ? sw : 1;
                const maxW = yy === ey ? ew : 53;

                for(let w=minW; w<=maxW; w++){
                    const info = getWeekRange(`${yy}-W${String(w).padStart(2,"0")}`);
                    labels.push(`${info.start}~${info.end} (${info.label})`);
                }
            }
        }

        /* ========== month ========== */
        if (type==="month") {
            let [sy, sm] = start.split("-").map(Number);
            let [ey, em] = end.split("-").map(Number);

            while(sy < ey || (sy === ey && sm <= em)){
                labels.push(`${sy}-${String(sm).padStart(2,"0")}`);
                sm++;
                if(sm > 12){ sy++; sm = 1; }
            }
        }

        /* ========== year ========== */
        if (type==="year") {
            for(let yy = Number(start); yy <= Number(end); yy++){
                labels.push(String(yy));
            }
        }

        createMainChart(labels);
    });

    /* =======================================
       주차 계산
    ======================================= */
    function getWeekRange(weekString) {
        const [year, w] = weekString.split("-W").map(Number);

        let simple = new Date(year, 0, 1 + (w - 1) * 7);
        let dow = simple.getDay();
        let start = new Date(simple);

        if (dow <= 4)     start.setDate(simple.getDate() - dow + 1);
        else             start.setDate(simple.getDate() + (8 - dow));

        let end = new Date(start);
        end.setDate(start.getDate() + 6);

        return {
            start : `${start.getMonth()+1}/${start.getDate()}`,
            end   : `${end.getMonth()+1}/${end.getDate()}`,
            label : `W${String(w).padStart(2,"0")}`
        };
    }


    /* =================================================
       리스트 테이블 + 페이징
    ================================================= */
    const sampleData = [
        {name:"강남직영점", addr:"서울시 강남구 일원동 664-9", diff:"5.3% 상승", order:7000, price:"68,000,000", date:"2025.10.1"},
        {name:"부산직영점", addr:"부산 서구 쌍용동 1201-1", diff:"3.1% 상승", order:5000, price:"56,000,000", date:"2025.10.1"},
        {name:"대전직영점", addr:"대전 서구 도산로 335", diff:"2.8% 상승", order:5500, price:"47,500,000", date:"2025.10.1"},
        {name:"관악직영점", addr:"서울시 관악구 인헌12다길", diff:"10% 상승", order:9500, price:"97,000,000", date:"2025.10.1"},
        {name:"금천직영점", addr:"서울시 금천구 독산동 331", diff:"5% 하락", order:6500, price:"38,000,000", date:"2025.10.1"},
        {name:"수원직영점", addr:"경기도 수원시 영통구 55", diff:"1.2% 상승", order:7200, price:"58,000,000", date:"2025.10.1"},
        {name:"인천직영점", addr:"인천 남동구 논현동 11", diff:"4.1% 상승", order:8200, price:"74,000,000", date:"2025.10.1"},
        {name:"광주직영점", addr:"광주 북구 일곡동 22", diff:"2.2% 상승", order:4300, price:"39,000,000", date:"2025.10.1"},
        {name:"대구직영점", addr:"대구 달서구 본리동 88", diff:"7.5% 상승", order:9000, price:"83,000,000", date:"2025.10.1"},
        {name:"창원직영점", addr:"창원시 성산구 상남동 45", diff:"3.8% 상승", order:6100, price:"49,000,000", date:"2025.10.1"}
    ];

    let currentPage = 1;

    function loadTable() {
        const tbody = $("#storeTable");
        const pageSize = Number($("#pageSize").val());
        tbody.empty();

        const start = (currentPage - 1) * pageSize;
        const end = start + pageSize;

        const pageData = sampleData.slice(start, end);

        pageData.forEach((item, idx) => {
            tbody.append(`
            <tr class="text-center">
                <td>${start + idx + 1}</td>
                <td>${item.name}</td>
                <td class="text-start">${item.addr}</td>
                <td>${item.diff}</td>
                <td>${item.order.toLocaleString()}</td>
                <td>${item.price}</td>
                <td>${item.date}</td>
                <td>
                    <img src="/image/detail.png"
                        style="width:24px;cursor:pointer;"
                        onclick="location.href='salesDetailUI.html'">
                </td>
            </tr>
        `);
        });

        createPagination();
    }

    function createPagination() {
        const pageSize = Number($("#pageSize").val());
        const totalPages = Math.ceil(sampleData.length / pageSize);
        const area = $("#paginationArea");

        let html = `<ul class="pagination pagination-sm">`;

        html += `
        <li class="page-item ${currentPage === 1 ? "disabled" : ""}">
            <a class="page-link" href="#" onclick="movePage(${currentPage - 1})">&lt;</a>
        </li>
    `;

        for (let i = 1; i <= totalPages; i++) {
            html += `
            <li class="page-item ${currentPage === i ? "active" : ""}">
                <a class="page-link" href="#" onclick="movePage(${i})">${i}</a>
            </li>
        `;
        }

        html += `
        <li class="page-item ${currentPage === totalPages ? "disabled" : ""}">
            <a class="page-link" href="#" onclick="movePage(${currentPage + 1})">&gt;</a>
        </li>
    `;

        html += `</ul>`;

        area.html(html);
    }

    function movePage(num) {
        currentPage = num;
        loadTable();
    }

    $("#pageSize").on("change", function() {
        currentPage = 1;
        loadTable();
    });

    loadTable();

    /* ======================================
       서브 차트 2개
    ====================================== */
    new Chart($("#storeSalesTop5Chart"), {
        type: 'bar',
        data: {
            labels: ['가산1호점', '강릉경포점', '부산서면점', '가산2호점', '부천시청점'],
            datasets: [{
                label: '매출금액(개)',
                data: [820, 740, 690, 650, 610],
                backgroundColor: ['#0d6efd','#6f42c1','#d63384','#fd7e14','#198754']
            }]
        },
        options: { indexAxis:'y', responsive:true }
    });

    new Chart($("#menuCountChart"), {
        type: 'doughnut',
        data: {
            labels: ['페퍼로니','치즈피자','콤비네이션','불고기피자','고구마피자'],
            datasets: [{
                data: [25, 18, 30, 15, 12],
                backgroundColor: ['#ff6384','#36a2eb','#ffcd56','#4bc0c0','#9966ff']
            }]
        },
        options: { responsive:true }
    });

</script>


</body>
</html>
