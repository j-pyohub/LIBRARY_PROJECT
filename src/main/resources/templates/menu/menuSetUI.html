<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>메뉴 수정</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <style>
        body {
            background-color: #f5f5f5 !important;
        }

        /* 계정등록과 동일: 전체를 감싸는 큰 박스 */
        .wrapper-box {
            background: white;
            padding: 40px;
            border-radius: 10px;
            border: 1px solid #ddd;
            max-width: 1500px;
            margin: 0 auto;
        }

        /* 내부 구역(기본정보/레시피정보) */
        .section-inner {
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 25px;
            margin-bottom: 30px;
        }

        th, td {
            vertical-align: middle !important;
        }

        thead th {
            position: sticky;
            top: 0;
            background: #f8f9fa;
            z-index: 5;
        }

        .table-responsive {
            max-height: 350px;
            overflow-y: auto;
        }

        /* 숫자 input 화살표 제거 */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }

        /* 노란 커스텀 버튼 */
        .custom-btn {
            background-color: #FFEEAA !important;
            border-color: #FFEEAA !important;
            color: #000;
        }
        .custom-btn:hover {
            background-color: #f2da84 !important;
            border-color: #f2da84 !important;
        }

        /* 회색 버튼 */
        .gray-btn {
            background-color: #D9D9D9 !important;
            border: #ffffff !important;
        }
        .gray-btn:hover {
            background-color: #C9C9C9 !important;
            border-color: #ffffff !important;
        }

    </style>
</head>

<body class="py-5">

<div class="wrapper-box">

    <!-- 제목 + 뒤로가기 -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold">메뉴 수정</h2>
        <button class="btn btn-outline-secondary" onclick="history.back()">뒤로가기</button>
    </div>

    <!-- ===================== -->
    <!-- 기본 정보 section -->
    <!-- ===================== -->
    <div class="section-inner">
        <h5 class="fw-bold mb-4">기본 정보</h5>

        <div class="row g-4">

            <div class="col-md-4">
                <label class="form-label fw-semibold">카테고리</label>
                <select class="form-select" disabled>
                    <option>피자</option>
                    <option>사이드디시</option>
                    <option>음료</option>
                </select>
            </div>

            <div class="col-md-4">
                <label class="form-label fw-semibold">메뉴 코드</label>
                <input type="text" class="form-control" value="PEPPERONI_PIZZA">
            </div>

            <div class="col-md-4">
                <label class="form-label fw-semibold">메뉴 명</label>
                <input type="text" class="form-control" value="페퍼로니 피자">
            </div>

            <!-- 사이즈 여부 -->
            <div class="col-md-4">
                <label class="form-label fw-semibold d-block">사이즈</label>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="sizeYn" value="Y" checked disabled>
                    <label class="form-check-label">유</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="sizeYn" value="N" disabled>
                    <label class="form-check-label">무</label>
                </div>
            </div>

            <!-- 가격 -->
            <div class="col-md-4 price-large">
                <label class="form-label fw-semibold">라지 가격</label>
                <div class="input-group input-group-sm w-auto">
                    <input type="number" class="form-control" value="25000">
                    <span class="input-group-text">원</span>
                </div>
            </div>

            <div class="col-md-4 price-medium">
                <label class="form-label fw-semibold">미디움 가격</label>
                <div class="input-group input-group-sm w-auto">
                    <input type="number" class="form-control" value="18000">
                    <span class="input-group-text">원</span>
                </div>
            </div>

            <div class="col-md-4 price-single" style="display:none;">
                <label class="form-label fw-semibold">판매 가격</label>
                <div class="input-group input-group-sm w-auto">
                    <input type="number" class="form-control">
                    <span class="input-group-text">원</span>
                </div>
            </div>

            <div class="col-12">
                <label class="form-label fw-semibold">설명</label>
                <textarea class="form-control" rows="3">짭짤한 맛이 일품인 페퍼로니 피자~</textarea>
            </div>

            <div class="col-md-4">
                <label class="form-label fw-semibold">출시 상태</label>
                <select class="form-select">
                    <option>출시 예정</option>
                    <option selected>출시 중</option>
                    <option>출시 중지</option>
                </select>
            </div>

            <div class="col-md-4">
                <label class="form-label fw-semibold">대표 이미지</label>
                <input type="file" class="form-control">
            </div>

        </div>
    </div>

    <!-- ===================== -->
    <!-- 레시피 정보 section -->
    <!-- ===================== -->
    <div class="section-inner">

        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="fw-bold">레시피(재료) 정보</h5>
            <button class="btn btn-sm custom-btn" data-bs-toggle="modal" data-bs-target="#ingredientModal">
                + 재료 불러오기
            </button>
        </div>

        <table class="table text-center align-middle">
            <thead class="table-light">
            <tr>
                <th>재료명</th>
                <th>단위</th>
                <th class="size-option">라지 정량</th>
                <th class="size-option">미디움 정량</th>
                <th class="qty-single-header" style="display:none;">정량</th>
                <th>삭제</th>
            </tr>
            </thead>

            <tbody id="recipeList"></tbody>
        </table>

    </div>

    <div class="text-center mt-3">
        <button class="btn custom-btn">저장</button>
        <button class="btn gray-btn">취소</button>
    </div>

</div>

<!-- ============================= -->
<!-- ⭐ 재료 불러오기 모달 ⭐ -->
<!-- ============================= -->
<div class="modal fade" id="ingredientModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="fw-bold modal-title">재료 불러오기</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">

                <!-- 검색 -->
                <div class="row g-3 mb-3">
                    <div class="col-md-3">
                        <label class="form-label fw-semibold">카테고리</label>
                        <select class="form-select">
                            <option>전체</option>
                            <option>도우</option>
                            <option>소스</option>
                            <option>치즈</option>
                            <option>토핑</option>
                        </select>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label fw-semibold">검색조건</label>
                        <select class="form-select">
                            <option>품목코드</option>
                            <option>재료명</option>
                        </select>
                    </div>

                    <div class="col-md-3 d-flex align-items-end">
                        <button class="btn btn-outline-dark">조회</button>
                    </div>
                </div>

                <!-- 테이블 -->
                <div class="table-responsive">
                    <table class="table table-hover text-center align-middle">
                        <thead class="table-light">
                        <tr>
                            <th><input type="checkbox" id="checkAll"></th>
                            <th>품목 코드</th>
                            <th>재료 명</th>
                            <th>카테고리</th>
                            <th>기준 단위</th>
                        </tr>
                        </thead>

                        <tbody id="ingredientTableBody">

                        <tr>
                            <td><input type="checkbox" class="row-check"></td>
                            <td>DOUGH-M</td>
                            <td>피자 도우 M</td>
                            <td>도우</td>
                            <td>ea</td>
                        </tr>

                        <tr>
                            <td><input type="checkbox" class="row-check"></td>
                            <td>CHEESE-MOZZ</td>
                            <td>모짜렐라 치즈</td>
                            <td>치즈</td>
                            <td>g</td>
                        </tr>

                        <tr>
                            <td><input type="checkbox" class="row-check"></td>
                            <td>SAUCE-TOMATO</td>
                            <td>토마토 소스</td>
                            <td>소스</td>
                            <td>g</td>
                        </tr>

                        </tbody>
                    </table>
                </div>

            </div>

            <div class="modal-footer">
                <button class="btn custom-btn" id="modalAddSelected">선택 재료 등록</button>
                <button class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
            </div>

        </div>
    </div>
</div>


<script>

    // 사이즈 유무 표시
    function updateSize() {
        const isSize = $("input[name='sizeYn']:checked").val() === "Y";

        $(".price-large").toggle(isSize);
        $(".price-medium").toggle(isSize);
        $(".price-single").toggle(!isSize);

        $("th.size-option, td.size-option").toggle(isSize);
        $("th.qty-single-header, td.qty-single-cell").toggle(!isSize);
    }
    updateSize();

    // 전체 선택
    $("#checkAll").on("change", function () {
        $(".row-check").prop("checked", $(this).is(":checked"));
    });

    // 재료 추가
    $("#modalAddSelected").on("click", function () {
        const selectedRows = $(".row-check:checked");
        const recipeBody = $("#recipeList");
        const isSize = $("input[name='sizeYn']:checked").val() === "Y";

        selectedRows.each(function () {
            const row = $(this).closest("tr");
            const cols = row.children();
            const name = cols.eq(2).text();
            const unit = cols.eq(4).text();

            let html = "";

            if (isSize) {
                html = `
                <tr>
                    <td>${name}</td>
                    <td>${unit}</td>
                    <td class="size-option"><input type="number" class="form-control form-control-sm w-auto" placeholder="라지"></td>
                    <td class="size-option"><input type="number" class="form-control form-control-sm w-auto" placeholder="미디움"></td>
                    <td class="qty-single-cell" style="display:none;"></td>
                    <td><button class="btn btn-outline-danger btn-sm delete-row">삭제</button></td>
                </tr>`;
            } else {
                html = `
                <tr>
                    <td>${name}</td>
                    <td>${unit}</td>
                    <td class="size-option" style="display:none;"></td>
                    <td class="size-option" style="display:none;"></td>
                    <td class="qty-single-cell"><input type="number" class="form-control form-control-sm w-auto" placeholder="정량"></td>
                    <td><button class="btn btn-outline-danger btn-sm delete-row">삭제</button></td>
                </tr>`;
            }

            recipeBody.append(html);
        });

        $("#ingredientModal").modal("hide");
    });

    // 삭제
    $(document).on("click", ".delete-row", function () {
        $(this).closest("tr").remove();
    });

</script>

</body>
</html>
