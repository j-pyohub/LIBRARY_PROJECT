<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>메뉴 조회</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <style>
        .menuBox {
            cursor: pointer;
        }

        .tab-content-area {
            display: none;
        }

        .tab-active {
            display: block;
        }

        .custom-btn {
            background-color: #FFEEAA !important;
            border-color: #FFEEAA !important;
            color: #000;
        }

        .custom-btn:hover {
            background-color: #f2da84 !important;
            border-color: #f2da84 !important;
        }

        .custom-container {
            max-width: 1500px;
        }

        .scroll-area {
            height: 600px;
            overflow-y: auto;
        }


        .scroll-area::-webkit-scrollbar {
            width: 8px;
        }

        .scroll-area::-webkit-scrollbar-thumb {
            background: #ced4da;
            border-radius: 4px;
        }

        .table-fixed-header {
            width: 100%;
            border-spacing: 0;
        }

        .table-fixed-header thead th {
            position: sticky;
            top: 0;
            z-index: 10;
            background: #f8f9fa; /* table-light 배경 */
        }


    </style>
</head>

<body class="bg-light py-3">
<!--계정별 툴바 다르게-->
<div class="container custom-container mt-5">
    <div class="bg-white border rounded p-4">
        <!-- 제목 / 버튼 -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="fw-bold">메뉴 조회</h2>
            <div>
                <!--                직영점 로그인 시에는 메뉴등록버튼 안 보이게 / 직영점별 판매 메뉴 보기 -> 판매 메뉴 보기-->
                <button class="btn btn-warning me-2 custom-btn" id="menuAddBtn">메뉴 등록</button>
                <button class="btn custom-btn" id="storeMenuBtn">직영점별 판매 메뉴 보기</button>
            </div>
        </div>

        <!-- 카테고리 + 탭 -->
        <div class="d-flex align-items-center mb-3">
            <div class="me-4">
                <label class="fw-semibold me-2">카테고리</label>
                <select class="form-select d-inline-block w-auto" name="category">
                    <option value="">전체</option>
                    <option value="pizza">피자</option>
                    <option value="side">사이드디시</option>
                    <option value="drink">음료</option>
                    <option value="etc">기타</option>
                </select>
            </div>

            <div class="me-4">
                <label class="fw-semibold me-2">출시 상태</label>
                <select class="form-select d-inline-block w-auto" name="category">
                    <option value="">전체</option>
                    <option value="commingSoon">출시 예정</option>
                    <option value="now">출시 중</option>
                    <option value="end">출시 중단</option>
                </select>
            </div>

            <!-- 탭 버튼 -->
            <div class="ms-auto d-flex align-items-center gap-2">
                <span class="fw-semibold">보기</span>
                <button class="btn btn-dark btn-sm" data-tab="list">목록</button>
                <button class="btn btn-outline-dark btn-sm" data-tab="image">이미지</button>
            </div>
        </div>

        <!-- 목록 뷰 -->
        <div class="tab-content-area tab-active list scroll-area">
            <table class="table text-center align-middle bg-white rounded shadow-sm table-fixed-header">
                <thead class="table-light">
                <tr>
                    <th>카테고리</th>
                    <th>메뉴 코드</th>
                    <th>메뉴 명</th>
                    <th>사이즈</th>
                    <th>가격</th>
                    <th>출시 상태</th>
                    <th>상세</th>
                </tr>
                </thead>
                <tbody id="menuListBody">
                </tbody>
            </table>
        </div>

        <!-- 이미지 뷰 -->
        <div class="tab-content-area image">
            <div class="row g-3">
                <div class="col-6 col-md-3">
                    <div class="border rounded p-2 bg-white shadow-sm text-center menuBox">
                        <img src="https://via.placeholder.com/120" class="img-fluid mb-2">
                        <div>페퍼로니 피자</div>
                        <small class="text-muted">라지 | 25,000원 | 출시 중</small><br>
                        <small class="text-muted">미디움 | 15,000원 | 출시 중</small>
                    </div>
                </div>

                <div class="col-6 col-md-3">
                    <div class="border rounded p-2 bg-white shadow-sm text-center menuBox">
                        <img src="https://via.placeholder.com/120" class="img-fluid mb-2">
                        <div>치즈 피자</div>
                        <small class="text-muted">23,000원 | 출시 중</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        loadMenuList();

        function loadMenuList() {
            fetch("/menuList")
                .then(res => res.json())
                .then(menuList => renderMenuList(menuList));
        }

        function groupByMenuCode(menuList) {
            const groups = {};
            menuList.forEach(menu => {
                if (!groups[menu.menuCode]) {
                    groups[menu.menuCode] = [];
                }
                groups[menu.menuCode].push(menu);
            });
            return groups;
        }

        function renderMenuList(menuList) {
            const tbody = $("#menuListBody");
            let html = "";

            const grouped = groupByMenuCode(menuList);

            Object.values(grouped).forEach(group => {
                const first = group[0];
                const rowspan = group.length;

                html += `
        <tr>
            <td rowspan="${rowspan}">${first.menuCategory}</td>
            <td rowspan="${rowspan}">${first.menuCode}</td>
            <td rowspan="${rowspan}">${first.menuName}</td>

            <td>${first.size}</td>
            <td>${first.menuPrice}</td>

            <td rowspan="${rowspan}">${first.releaseStatus}</td>

            <td rowspan="${rowspan}">
                <button type="button" class="btn btn-sm detailBtn" data-menu-no="${first.menuNo}">
                    <i class="bi bi-file-earmark-text" style="font-size: 1.6rem;"></i>
                </button>
            </td>
        </tr>
        `;

                for (let i = 1; i < group.length; i++) {
                    html += `
            <tr>
                <td>${group[i].size}</td>
                <td>${group[i].menuPrice}</td>
            </tr>
            `;
                }
            });

            tbody.html(html);
        }



        $("[data-tab]").on("click", function () {
            const tabName = $(this).data("tab");

            // 콘텐츠 탭 활성화 전환
            $(".tab-content-area").removeClass("tab-active");
            $("." + tabName).addClass("tab-active");

            // 탭 버튼 스타일 전환
            $("[data-tab]").removeClass("btn-dark").addClass("btn-outline-dark");
            $(this).removeClass("btn-outline-dark").addClass("btn-dark");
        });
    });

    $("#storeMenuBtn").click(() => {
        //지금은 본사 기준. 직영점 로그인 시, storeMenuUI.html로 이동하게 해야 함
        location.href = "storeMenuManagerUI.html"
    });
    $(document).on("click", ".detailBtn", function () {
        const menuNo = $(this).data("menuNo");
        location.href = `/menuDetail?menuNo=${menuNo}`;
    });

    $(".menuBox").click(() => {
        location.href = "menuDetailUI.html"
    });
    $("#menuAddBtn").click(() => {
        location.href = "menuAddUI.html"
    })

</script>

</body>
</html>
